<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Image to Hash and Lookup</title>
</head>
<body>
    <h1>Chuyển hình ảnh sang Hash và Tra cứu</h1>
    
    <!-- Phần chuyển hình ảnh sang hash -->
    <h2>Chuyển hình ảnh sang Hash</h2>
    <input type="file" id="fileInput" accept="image/*">
    <textarea id="hashOutput" rows="2" cols="50" readonly></textarea>
    <button onclick="convertAndHashImage()">Convert & Hash</button>

    <hr>

    <!-- Phần tra cứu hình ảnh từ hash -->
    <h2>Tra cứu hình ảnh từ Hash</h2>
    <input type="text" id="hashInput" placeholder="Nhập hash">
    <button onclick="lookupImage()">Lookup</button>
    <br>
    <img id="imageOutput" src="" alt="Image Preview" style="max-width: 300px; margin-top: 20px;">

    <!-- Thư viện crypto-js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/crypto-js.min.js"></script>
    <script>
        let imageHashMap = JSON.parse(localStorage.getItem('imageHashMap')) || {};

        function convertAndHashImage() {
            const file = document.getElementById('fileInput').files[0];
            const reader = new FileReader();
            reader.onload = function() {
                const base64 = reader.result.split(',')[1]; // Lấy phần Base64 của hình ảnh
                const hash = CryptoJS.SHA256(base64).toString(CryptoJS.enc.Hex);
                document.getElementById('hashOutput').value = hash;
                imageHashMap[hash] = reader.result; // Lưu trữ hash và hình ảnh tương ứng

                // Lưu imageHashMap vào localStorage
                localStorage.setItem('imageHashMap', JSON.stringify(imageHashMap));
            };
            reader.readAsDataURL(file);
        }

        function lookupImage() {
            const hash = document.getElementById('hashInput').value;
            if (imageHashMap[hash]) {
                document.getElementById('imageOutput').src = imageHashMap[hash];
            } else {
                alert('Hash không hợp lệ hoặc không có hình ảnh tương ứng.');
            }
        }
    </script>
</body>
</html>
